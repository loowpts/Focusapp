{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Task Tracker{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
  <nav>
    <div class="navbar">
      <a class="navbar-brand" href="{% url 'main:task_list' %}">Task Tracker</a>
      <button class="nav-toggle" aria-label="Toggle navigation">☰</button>
      <div class="nav-links">
        {% if user.is_authenticated %}
          <a href="{% url 'main:task_list' %}">Задачи</a>
          <a href="{% url 'habit_tracker:daily_habits' %}">Трекер привычек</a>
          <a href="{% url 'main:calendar' %}">Календарь</a>
          <a href="{% url 'users:profile' %}">{{ user.username }}</a>
          <form action="{% url 'users:logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="logout-btn">Выйти</button>
          </form>
        {% else %}
          <a href="{% url 'users:login' %}">Войти</a>
          <a href="{% url 'users:register' %}">Регистрация</a>
        {% endif %}
      </div>
    </div>
  </nav>

  <main>
    {% block content %}{% endblock %}
  </main>

  <footer>
    <div>&copy; {{ now|date:"Y" }} loowpts</div>
  </footer>

  {% if messages %}
  <div class="toast-container">
    {% for message in messages %}
      <div class="toast {{ message.tags }}">
        <div class="toast-body">{{ message }}</div>
        <button class="toast-close" aria-label="Закрыть">✕</button>
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <script>
    // Mobile navigation toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navLinks = document.querySelector('.nav-links');
    navToggle.addEventListener('click', () => {
      navLinks.classList.toggle('active');
    });

    // Toast handling
    document.querySelectorAll('.toast').forEach(toast => {
      const closeBtn = toast.querySelector('.toast-close');
      closeBtn.addEventListener('click', () => {
        toast.style.animation = 'slideOut 0.3s ease forwards';
        setTimeout(() => toast.remove(), 300);
      });
      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease forwards';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    });

    const styleSheet = document.styleSheets[0];
    styleSheet.insertRule(`
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `, styleSheet.cssRules.length);
  </script>
</body>
</html>
